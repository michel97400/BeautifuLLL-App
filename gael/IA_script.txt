

CREATE TABLE Role(
   id_role INT AUTO_INCREMENT,
   nom_role VARCHAR(50) NOT NULL UNIQUE,
   PRIMARY KEY(id_role)
);

CREATE TABLE matieres(
   id_matieres INT AUTO_INCREMENT,
   nom_matieres VARCHAR(50) NOT NULL,
   description_matiere TEXT,
   PRIMARY KEY(id_matieres)
);

CREATE TABLE niveau(
   id_niveau INT AUTO_INCREMENT,
   libelle_niveau VARCHAR(50) NOT NULL,
   PRIMARY KEY(id_niveau)
);

CREATE TABLE etudiants(
   id_users INT AUTO_INCREMENT,
   nom VARCHAR(50) NOT NULL,
   prenom VARCHAR(50) NOT NULL,
   email VARCHAR(100) NOT NULL,
   avatar VARCHAR(255),
   passwordhash VARCHAR(255) NOT NULL,
   date_inscription DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
   consentement_rgpd BOOLEAN NOT NULL DEFAULT FALSE,
   id_niveau INT NOT NULL,
   id_role INT NOT NULL,
   PRIMARY KEY(id_users),
   UNIQUE(email),
   FOREIGN KEY(id_niveau) REFERENCES niveau(id_niveau),
   FOREIGN KEY(id_role) REFERENCES Role(id_role)
);

CREATE TABLE agent(
   id_agents INT AUTO_INCREMENT,
   nom_agent VARCHAR(50) NOT NULL,
   type_agent VARCHAR(50) NOT NULL,
   avatar_agent VARCHAR(255),
   est_actif BOOLEAN DEFAULT TRUE,
   description TEXT,
   date_creation DATETIME DEFAULT CURRENT_TIMESTAMP,
   prompt_systeme TEXT,
   id_matieres INT,
   id_users INT NOT NULL,
   PRIMARY KEY(id_agents),
   UNIQUE(nom_agent),
   FOREIGN KEY(id_matieres) REFERENCES matieres(id_matieres),
   FOREIGN KEY(id_users) REFERENCES etudiants(id_users)
);

CREATE TABLE SESSION_CONVERSATION(
   id_session INT AUTO_INCREMENT,
   date_heure_debut DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
   duree_session TIME,
   date_heure_fin DATETIME,
   id_agents INT NOT NULL,
   id_users INT NOT NULL,
   PRIMARY KEY(id_session),
   FOREIGN KEY(id_agents) REFERENCES agent(id_agents),
   FOREIGN KEY(id_users) REFERENCES etudiants(id_users)
);

CREATE TABLE MESSAGE(
   id_message INT AUTO_INCREMENT,
   role ENUM('user', 'assistant') NOT NULL,
   contenu TEXT NOT NULL,
   date_envoi DATETIME DEFAULT CURRENT_TIMESTAMP,
   id_session INT NOT NULL,
   PRIMARY KEY(id_message),
   FOREIGN KEY(id_session) REFERENCES SESSION_CONVERSATION(id_session)
);


INSERT INTO Role (nom_role) VALUES 
('Administrateur'),
('Etudiant');

